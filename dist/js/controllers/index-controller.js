app.controller("IndexController",["$scope","$http","$window","$rootScope",function(o,a,r,e){o.teste="vinicius",o.validacao_email=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,o.nomevalidacao_somente_letras_com_caracter_especial=/^[A-Za-záàâãéèêíïóôõöúçñÁÀÂÃÉÈÍÏÓÔÕÖÚÇÑ'\s]+$/,o.validacao_somente_letras=/^[a-zA-Z ]{1,25}$/,o.validacao_somente_numeros=/^[0-9]*$/,o.validacao_telefone=/^[0-9]{8,9}$/,o.pessoa={codigo:null,cpf_cnpj:null,nome:null,email:null,telefone:null,residencial:null,cep:null,rua:null,numero_casa:null,bairro:null,complemento:null,cidade:null,uf:null},o.maskCPF=function(e){return e.substring(0,3)+"."+e.substring(3,6)+"."+e.substring(6,9)+"-"+e.substring(9,11)},o.maskCNPJ=function(e){return e.substring(0,2)+"."+e.substring(2,5)+"."+e.substring(5,8)+"/"+e.substring(8,12)+"-"+e.substring(12,14)},o.reset=function(){angular.copy({},o.pessoa),o.formulario.$setPristine(),o.formulario.$setUntouched()},o.criarCliente=function(){console.log(o.formulario)},o.validaCPF=function(e){for(var o=e.substr(0,9),a=e.substr(9,2),r=0,s=0;s<9;s++)r+=o.charAt(s)*(10-s);if(0==r)return!1;if(9<(r=11-r%11)&&(r=0),a.charAt(0)!=r)return!1;r*=2;for(s=0;s<9;s++)r+=o.charAt(s)*(11-s);return 9<(r=11-r%11)&&(r=0),a.charAt(1)==r},o.validaCNPJ=function(e){var o=new Array,a=new Number,r=[6,5,4,3,2,9,8,7,6,5,4,3,2];for(i=0;i<12;i++)o[i]=e.charAt(i),a+=o[i]*r[i+1];for((x=a%11)<2?o[12]=0:o[12]=11-x,a=0,y=0;y<13;y++)a+=o[y]*r[y];return(x=a%11)<2?o[13]=0:o[13]=11-x,e.charAt(12)==o[12]&&e.charAt(13)==o[13]},o.consultaCliente=function(e){cpf=e.pessoa.cpf_cnpj.replace(/\D/g,""),a({method:"GET",url:"http://187.111.10.182:8998/ideia/core/pessoa/"+cpf,headers:{Accept:"text/html"}}).then(function(e){"message"in e.data?(console.log(e),r.alert("Nenhum dado encontrado")):(o.result=e.data.data.pessoa,o.pessoa.codigo=o.result[0].codigo,o.pessoa.cpf_cnpj=o.result[0].cpf,o.pessoa.nome=o.result[0].nome,o.pessoa.email=o.result[0].emailcontato,o.pessoa.telefone=o.result[0].telefone,o.pessoa.residencial=o.result[0].telefonecontato,o.pessoa.cep=o.result[0].enderecocep,o.pessoa.rua=o.result[0].endereco,o.pessoa.numero_casa=o.result[0].endereconumero,o.pessoa.complemento=o.result[0].enderecocomplemento,o.pessoa.bairro=o.result[0].enderecobairro,o.pessoa.cidade=o.result[0].cidade_nome,o.pessoa.uf=o.result[0].uf,console.log("Resultado: ",o.result))},function(e){r.alert("Serviço indisponível no momento"),console.log("Algo deu errado: ",e)})},o.validaCampoCpfCnpj=function(e){return valor=e.pessoa.cpf_cnpj.replace(/\D/g,""),tam=valor.length,11!=tam&&14!=tam?(o.formulario.cpf_cnpj.$setValidity("cpf_cnpj",!1),!1):11==tam?this.validaCPF(valor)?(o.formulario.cpf_cnpj.$setValidity("cpf_cnpj",!0),e.pessoa.cpf_cnpj=this.maskCPF(valor),!0):(o.formulario.cpf_cnpj.$setValidity("cpf_cnpj",!1),!1):14==tam?this.validaCNPJ(valor)?(o.formulario.cpf_cnpj.$setValidity("cpf_cnpj",!0),e.pessoa.cpf_cnpj=this.maskCNPJ(valor),!0):(o.formulario.cpf_cnpj.$setValidity("cpf_cnpj",!1),!1):void 0},o.consultaCep=function(e){if(cep=e.pessoa.cep,limparFormulario=function(){o.pessoa.rua="",o.pessoa.bairro="",o.pessoa.cidade="",o.pessoa.uf=""},""!=cep){/^[0-9]{8}$/.test(cep)?(o.pessoa.rua="...",o.pessoa.bairro="...",o.pessoa.cidade="...",o.pessoa.uf="...",a({method:"GET",url:"https://viacep.com.br/ws/"+cep+"/json/?callback="}).then(function(e){"erro"in e.data?(limparFormulario(),r.alert("Cep não encontrado.")):(o.pessoa.rua=e.data.logradouro,o.pessoa.bairro=e.data.bairro,o.pessoa.cidade=e.data.localidade,o.pessoa.uf=e.data.uf)},function(e){r.alert("O serviço de busca de CEP está indisponível no momento."),limparFormulario()})):(limparFormulario(),r.alert("Formato de CEP inválido"))}else limparFormulario()}}]);